name: Build Ice

runs:
  using: "composite"
  steps:
    - name: Build C++ Dependencies
      env:
        CONFIGS: "cpp98-shared cpp11-shared"
      run: make -j3 V=1 -C cpp srcs
      shell: bash
      if: runner.os == 'macOS' || runner.os == 'Linux'

    - name: Build C++ 98 Tests for Scripting Languages
      env:
        CONFIGS: "cpp98-shared"
      run: make -j3 V=1 -C cpp tests
      shell: bash
      if: (runner.os == 'macOS' || runner.os == 'Linux') && (matrix.language == 'php' || matrix.language == 'js' || matrix.language == 'ruby')

    - name: Build ${{ matrix.language }}
      env:
        CONFIGS: "shared cpp98-shared cpp11-shared"
      run: |
        make -j3 V=1 LANGUAGES="${{ matrix.language }}"
      shell: bash
      if: runner.os == 'macOS' || runner.os == 'Linux'

    - name: Build
      run: msbuild /m /p:Platform=x64 ice.proj
      shell: powershell
      if: runner.os == 'Windows'
